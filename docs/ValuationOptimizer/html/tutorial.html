<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &#8212; Valuation Optimizer  documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> class essentially provides a framework for creating a desired Pyomo model for the energy storage valuation problem and solving it. The basic process flow for using this tool is as follows:</p>
<ol class="arabic">
<li><p class="first">Create an instance of the <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> class, optionally providing keyword arguments to the constructor.</p>
</li>
<li><p class="first">Load historical data using packaged utilities or otherwise.</p>
</li>
<li><p class="first">Populate the instance&#8217;s attributes.</p>
<blockquote>
<div><ul class="simple">
<li>Assign the loaded data.</li>
<li>Assign values to parameters such as maximum state of charge.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Populate the Pyomo model using the instance&#8217;s attributes.</p>
</li>
<li><p class="first">Create a solver and solve the populated Pyomo model.</p>
</li>
<li><p class="first">Analyze the results.</p>
</li>
</ol>
<div class="section" id="creating-an-optimizer-instance">
<h2>Creating an Optimizer instance<a class="headerlink" href="#creating-an-optimizer-instance" title="Permalink to this headline">¶</a></h2>
<p>First, the module must be imported:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">optimizer</span> <span class="k">import</span> <span class="n">Optimizer</span>
</pre></div>
</div>
<p>Now the constructor can be called to create an instance of the <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">()</span>
</pre></div>
</div>
<p>No arguments or keyword arguments are required, but may be supplied at instantiation. For example, if locational marginal prices are already loaded in memory, you may assign it to the <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> instance:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_lmp</span> <span class="o">=</span> <span class="n">load_lmp</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">my_optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span><span class="n">lmp</span><span class="o">=</span><span class="n">my_lmp</span><span class="p">)</span>
</pre></div>
</div>
<p>Or, if you want to set the market type to PJM&#8217;s pay-for-performance and the solver to Gurobi:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span><span class="n">market_type</span><span class="o">=</span><span class="s1">&#39;pjm_pfp&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-historical-data">
<h2>Loading historical data<a class="headerlink" href="#loading-historical-data" title="Permalink to this headline">¶</a></h2>
<p>This tool is packaged with example_datasheet.xlsx, an Excel workbook that has compiled into a format that has been tested to run using utilities packaged with the tool.</p>
<p>Although not required to provide input data in this format, you can use the functions in <code class="xref py py-func docutils literal"><span class="pre">utilities()</span></code> such as <code class="xref py py-func docutils literal"><span class="pre">utilities.get_lmp()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">utilities.import_workbook()</span></code> to facilitate loading data into memory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utilities</span> <span class="k">import</span> <span class="n">import_workbook</span><span class="p">,</span> <span class="n">get_lmp</span><span class="p">,</span> <span class="n">get_reg_prices</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;example_datasheet.xlsx&#39;</span>
<span class="n">loc_name</span> <span class="o">=</span> <span class="s1">&#39;HB_HOUSTON&#39;</span>
<span class="n">market_type</span> <span class="o">=</span> <span class="s1">&#39;arbreg&#39;</span>

<span class="n">dfs</span> <span class="o">=</span> <span class="n">import_workbook</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">lmp</span> <span class="o">=</span> <span class="n">get_lmp</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">loc_name</span><span class="p">)</span>
<span class="n">ru</span><span class="p">,</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">get_reg_prices</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>

<span class="n">optimizer_instance</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span><span class="n">lmp</span><span class="p">,</span> <span class="n">ru</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">market_type</span><span class="o">=</span><span class="n">market_type</span><span class="p">)</span>
</pre></div>
</div>
<p>Data was loaded from the included example_datasheet.xlsx for the &#8216;HB_HOUSTON&#8217; pricing node using the <code class="xref py py-func docutils literal"><span class="pre">utilities()</span></code> functions. An <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> instance was constructed with the loaded data and prepared to optimize for participation in arbitrage and regulation.</p>
</div>
<div class="section" id="populating-the-instance">
<h2>Populating the instance<a class="headerlink" href="#populating-the-instance" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> instance builds the Pyomo model using its own attributes. Therefore, its attributes, in particular data time series like LMP, must be assigned values before attempting to solve the model. For example, if optimization using arbitrage for revenue only is desired, the <code class="xref py py-attr docutils literal"><span class="pre">optimizer.Optimizer.lmp</span></code> attribute. must be assigned a value, either at instantiation or prior to executing a solve.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the energy storage device parameters listed in <code class="xref py py-func docutils literal"><span class="pre">param()</span></code> are not explicitly assigned values, they will take on default values indicated in the source code upon creation of the Pyomo model.</p>
</div>
<p>To populate the instance, you simply need to bind a value to an attribute reference:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">()</span>
<span class="n">lmp</span> <span class="o">=</span> <span class="n">get_lmp</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">loc_name</span><span class="p">)</span>

<span class="n">my_optimizer</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">lmp</span>
</pre></div>
</div>
<p>To use non-default values for device parameters, simply assign values to the instance attributes before executing <code class="xref py py-func docutils literal"><span class="pre">optimizer.Optimizer.instantiate_optimizer_model()</span></code> or <code class="xref py py-func docutils literal"><span class="pre">optimizer.Optimizer.create_optimizer_model()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span><span class="o">.</span><span class="n">S_max</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Sets the maximum state of charge of the device to 20 MWh</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Parameters, supplied by the user, are named with leading capital letters. Variables, solved for by the optimization routine, are named in all lower case.</p>
</div>
</div>
<div class="section" id="populating-the-pyomo-model">
<h2>Populating the Pyomo model<a class="headerlink" href="#populating-the-pyomo-model" title="Permalink to this headline">¶</a></h2>
<p>The Pyomo model is built from the <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> instance&#8217;s attributes using the <code class="xref py py-func docutils literal"><span class="pre">optimizer.Optimizer.instantiate_optimizer_model()</span></code> class method. It takes the <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> instance&#8217;s attributes related to data time series such as <code class="xref py py-attr docutils literal"><span class="pre">optimizer.Optimizer.lmp</span></code> and assigns them as parameters to a Pyomo concrete model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span><span class="o">.</span><span class="n">lmp</span> <span class="o">=</span> <span class="n">lmp</span>  <span class="c1"># assign LMP data to instance attribute</span>
<span class="n">my_optimizer</span><span class="o">.</span><span class="n">instantiate_optimizer_model</span><span class="p">()</span>  <span class="c1"># assigns my_optimizer.lmp to my_optimizer.model.lmp</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any changes to LMP, regulation price data, etc. must be proceeded by rerunning <code class="xref py py-func docutils literal"><span class="pre">optimizer.Optimizer.instantiate_optimizer_model()</span></code> to update the internal Pyomo model.</p>
</div>
<p>Likewise, the <code class="xref py py-func docutils literal"><span class="pre">optimizer.Optimizer.create_optimizer_model()</span></code> class method finalizes creation of the Pyomo model by defining model parameters, variables and constraints specific to the market type specified by <code class="xref py py-attr docutils literal"><span class="pre">optimizer.Optimizer.market_type</span></code>. Therefore, parameter values and other characteristic attributes such as market type must be finalized before executing this method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;gurobi&#39;</span>
<span class="n">my_optimizer</span><span class="o">.</span><span class="n">S_min</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">my_optimizer</span><span class="o">.</span><span class="n">instantiate_optimizer_model</span><span class="p">()</span>
<span class="n">my_optimizer</span><span class="o">.</span><span class="n">create_optimizer_model</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="solving-the-pyomo-model">
<h2>Solving the Pyomo model<a class="headerlink" href="#solving-the-pyomo-model" title="Permalink to this headline">¶</a></h2>
<p>Once the Pyomo model is well-defined with appropriate parameters, data, objectives, and constraints, it is ready to be solved. The <code class="xref py py-func docutils literal"><span class="pre">optimizer.Optimizer.solve_optimizer_model()</span></code> class method facilitates the process of solving the model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span><span class="o">.</span><span class="n">instantiate_optimizer_model</span><span class="p">()</span>
<span class="n">my_optimizer</span><span class="o">.</span><span class="n">create_optimizer_model</span><span class="p">()</span>
<span class="n">my_optimizer</span><span class="o">.</span><span class="n">solve_optimizer_model</span><span class="p">()</span>
</pre></div>
</div>
<p>Upon execution, Pyomo and the solver will notify you if the solve was successful or not.</p>
</div>
<div class="section" id="analyze-results">
<h2>Analyze results<a class="headerlink" href="#analyze-results" title="Permalink to this headline">¶</a></h2>
<p>The Pyomo model is solved &#8220;in place&#8221; and can be accessed via the <a class="reference internal" href="optimizer.html#module-optimizer" title="optimizer"><code class="xref py py-func docutils literal"><span class="pre">optimizer()</span></code></a> instance&#8217;s model attribute. In other words, the value of the decision variables is updated from their initializations after a successful solve. For example, to print the values of the device&#8217;s state of charge at each timestep:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">my_optimizer</span><span class="o">.</span><span class="n">solve_optimizer_model</span><span class="p">()</span>  <span class="c1"># solve the model</span>

<span class="n">my_model</span> <span class="o">=</span> <span class="n">my_optimizer</span><span class="o">.</span><span class="n">model</span>  <span class="c1"># create reference to the instance&#39;s model</span>
<span class="nb">print</span><span class="p">([</span><span class="n">my_model</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">my_model</span><span class="p">])</span>  <span class="c1"># print value of state of charge decision variable</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">my_model.s[n] will return a Pyomo Variable object. You must use the <code class="xref py py-func docutils literal"><span class="pre">value()</span></code> or value attribute of the object to obtain the actual numerical value.</p>
</div>
</div>
<div class="section" id="putting-it-all-together">
<h2>Putting it all together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this headline">¶</a></h2>
<p>Having gone through each step individually, we can put together a simple driver script example for executing an optimization over one month:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># PJM pay-for-performance example</span>
<span class="n">month</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="n">nodeid</span> <span class="o">=</span> <span class="s1">&#39;51216&#39;</span>

<span class="c1"># load data for given month, year, nodeid</span>
<span class="n">lmp</span><span class="p">,</span> <span class="n">MR</span><span class="p">,</span> <span class="n">regA</span><span class="p">,</span> <span class="n">regD</span><span class="p">,</span> <span class="n">regCCP</span><span class="p">,</span> <span class="n">regPCP</span><span class="p">,</span> <span class="n">ru</span><span class="p">,</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">load_pjm_data</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">)</span>

<span class="n">optimizer_instance</span> <span class="o">=</span> <span class="n">Optimizer</span><span class="p">(</span><span class="n">lmp</span><span class="o">=</span><span class="n">lmp</span><span class="p">,</span>
                               <span class="n">mi_ratio</span><span class="o">=</span><span class="n">MR</span><span class="p">,</span> <span class="n">regA_mi</span><span class="o">=</span><span class="n">regA</span><span class="p">,</span> <span class="n">regD_mi</span><span class="o">=</span><span class="n">regD</span><span class="p">,</span>
                               <span class="n">regCCP</span><span class="o">=</span><span class="n">regCCP</span><span class="p">,</span> <span class="n">regPCP</span><span class="o">=</span><span class="n">regPCP</span><span class="p">,</span>
                               <span class="n">gamma_ru_t</span><span class="o">=</span><span class="n">ru</span><span class="p">,</span> <span class="n">gamma_rd_t</span><span class="o">=</span><span class="n">rd</span><span class="p">,</span>
                               <span class="n">market_type</span><span class="o">=</span><span class="s1">&#39;pjm_pfp&#39;</span><span class="p">,</span>
                               <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;gurobi&#39;</span><span class="p">)</span>

<span class="c1"># change some parameter values</span>
<span class="n">optimizer_instance</span><span class="o">.</span><span class="n">S_max</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">optimizer_instance</span><span class="o">.</span><span class="n">Perf_score</span> <span class="o">=</span> <span class="mf">96.2</span>

<span class="c1"># build the model and solve</span>
<span class="n">optimizer_instance</span><span class="o">.</span><span class="n">instantiate_optimizer_model</span><span class="p">()</span>
<span class="n">optimizer_instance</span><span class="o">.</span><span class="n">create_optimizer_model</span><span class="p">()</span>
<span class="n">optimizer_instance</span><span class="o">.</span><span class="n">solve_optimizer_model</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/Quest_Logo_RGB.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Valuation Optimizer</h1>
    
  </a>
</p>



<p class="blurb">A framework for building optimization models for energy storage valuation.</p>






<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="model_storage.html">Energy storage model</a></li>
<li class="toctree-l1"><a class="reference internal" href="models_op.html">Optimization models</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimizer.html">Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="valuation_optimizer.html">ValuationOptimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="constraints.html">Constraints</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Ricky Concepcion.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/tutorial.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>