<head>
<!-- Fonts-->
<link href="https://fonts.googleapis.com/css?family=Exo+2|Open+Sans" rel="stylesheet"> 

<style>
  body {
    background-color: #005376;
    font-family: 'Open Sans', sans-serif;
    /* min-width: 900 px;
    max-width: 1000 px; */
  }

  h1,
  h2 {
    color: #005376;
    font-family: 'Exo 2', sans-serif;
  }

  h3 {
    color: #84BD00;
  }

  div {
    word-wrap: normal;
  }

  #page {
    background-color: #FFFFFF;
    /* border: 1px solid #000000; */
    margin: 10px auto 10px auto;
    padding: 10px 20px 10px 20px;
    min-width: 900px;
    max-width: 1000px;
  }

  #logo-header {
    /* width: 800px; */
    margin: 0px auto;
  }

  img.logo-header {
    width: 300px;
    display: block;
    margin: 0px auto;
  }

  table,
  th,
  td {
    border: 1px solid black;
    border-collapse: collapse;
  }
</style>

<!-- Use MathJax to render mathematics -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>


<div id="page">
<title>Report</title>

<div id="logo-header">
  <img src="{{ QuESt_Logo }}" alt="QuESt logo" class="logo-header" />
</div>

<center><h1>Behind-the-Meter Energy Storage Cost Savings Report</h1></center>

<center><i>Autogenerated using QuESt BTM</i></center>
<center><h4> {{ today }} </h4></center>


{{ header }}


<h2>Scenario Summary</h2>

{% for component in summary_components %}
<div>
  <b>{{ component.name }}:</b> {{ component.value }}
</div>
<br />
{% endfor %}

{% if pv_profile_summary %}
<h3>PV Profile</h3>

{% for parameter in pv_profile_summary %}
<div>
  {{ parameter }}
  <br />
</div>
{% endfor %}
{% endif %}

<br />

<h3>Energy Storage System Parameters</h3>
<br />
<br />


<div align="center"> <!-- center content -->
<table width="50%", class="center">
  <tr>
    <th>Parameter</th>
    <th>Value</th> 
    <th>Units</th>
  </tr>
  <tr>
    <td> Power rating </td>
    <td> {{ power_rating }} </td>
    <td> MW </td>
  </tr>
  <tr>
    <td> Energy Capacity </td>
    <td> {{ energy_capacity }} </td>
    <td> MWh </td>
  </tr>
  <tr>
    <td> Round-trip efficiency </td>
    <td> {{ conversion_efficiency }} </td>
    <td> % </td>
  </tr>
  <tr>
    <td> Self-discharge efficiency </td>
    <td> {{ storage_efficiency }} </td>
    <td> %/hour </td>
  </tr>
</table>
<h4>Table 1: Energy Storage Device Characteristics</h4>
</div>

<h2>Optimization Formulation</h2>

We solve the following mathematical optimization problem to maximize revenue using energy storage, and the notation is described in Table 2 below.

<h3>Tu please add formulation and nomenclature table</h3>

<!-- \begin{align}
\max_{q^\text{d},q^\text{r},q^\text{ru},q^\text{rd}} \sum_{i \in \mathcal{T}} \big( \lambda_i q_i^\text{d} - \lambda_i q_i^\text{r} + \lambda_i^\text{c,ru} q_i^\text{ru} + \lambda_i^\text{c,rd} q_i^\text{rd} + \lambda_i \delta_i^\text{ru} q_i^\text{ru} - \lambda_i \delta_i^\text{rd} q_i^\text{rd} + \gamma_i^\text{ru}\beta_i^\text{ru}\lambda_i^\text{p,ru} + \gamma_i^\text{rd}\beta_i^\text{rd}\lambda_i^\text{p,rd} \big) e^{-Ri}
\end{align}
<br />
subject to the following constraints
<br />
\begin{align}
S_{i+1} = \eta_\text{s} S_i + \eta_\text{c} q_i^\text{r} & - q_i^\text{d} + \eta_\text{c} \delta_i^\text{rd} q_i^\text{rd} - \delta_i^\text{ru} q_i^\text{ru} \\
0 \leq S_i & \leq \bar{S} \\
q_i^\text{r} + q_i^\text{d} + q_i^\text{ru} + q_i^\text{rd} & \leq \bar Q
\end{align}
<br />
for all time periods \(i \in \mathcal{T} \). The total revenue can be calculated as           
<br />
\begin{align}
r_\text{arb} & = \sum_{i \in \mathcal{T}} \lambda_i \big( q_i^\text{d} - q_i^\text{r} \big) \\
r_\text{reg} & = \sum_{i \in \mathcal{T}} \lambda_i^\text{c,ru} q_i^\text{ru} + \lambda_i^\text{c,rd} q_i^\text{rd} + \lambda_i(\delta_i^\text{ru} q_i^\text{ru} - \delta_i^\text{rd} q_i^\text{rd}) + \gamma_i^\text{ru}\beta_i^\text{ru}\lambda_i^\text{p,ru} + \gamma_i^\text{rd}\beta_i^\text{rd}\lambda_i^\text{p,rd}\\
r & = r_\text{arb} + r_\text{reg}
\end{align}
<br />
The data required to run this analysis in CAISO are the day ahead LMP, mileage multiplier, reg up price, reg down price, reg mileage up price and reg mileage down price.
<br />
<br />
NOTE: If the energy storage device is not participating in frequency regulation, \( q_i^\text{ru} \) and \( q_i^\text{rd} \) are equal to zero for all \( i \in \mathcal{T} \).
<br />
<br /> -->

<!-- <div align="center">
<table width="70%", class="center">
  <tr>
    <th>Parameter</th>
    <th>Description</th> 
    <th>Units</th>
  </tr>
  <tr>
    <td>\( q_i^\text{r} \) </td>
    <td> Energy charged from time period \(i\) to \(i+1\) </td> 
    <td> MWh </td>
  </tr>
  <tr>
    <td>\( q_i^\text{d} \) </td>
    <td> Energy discharged from time period \(i\) to \(i+1\) </td> 
    <td> MWh </td>
  </tr>
  <tr>
    <td>\( q_i^\text{ru} \) </td>
    <td> Energy allocated for frequency regulation up from time period \(i\) to \(i+1\) </td> 
    <td> MWh </td>
  </tr>
  <tr>
    <td>\( q_i^\text{rd} \) </td>
    <td> Energy allocated for frequency regulation down from time period \(i\) to \(i+1\) </td> 
    <td> MWh </td>
  </tr>
  <tr>
    <td>\( S_i \) </td>
    <td>Energy storage state of charge at time period \(i\)</td> 
    <td> MWh </td>
  </tr>
  <tr>
    <td>\( \bar{Q} \) </td>
    <td>Power rating</td> 
    <td> MW </td>
  </tr>
  <tr>
    <td>\( \bar{S} \) </td>
    <td>Energy capacity</td> 
    <td> MWh </td>
  </tr>
  <tr>
    <td> \( \eta_\text{s} \) </td>
    <td> Self-discharge efficiency</td> 
    <td> % </td>
  </tr>
  <tr>
    <td>\( \eta_\text{c} \) </td>
    <td> Round-trip efficiency</td> 
    <td> % </td>
  </tr>
  <tr>
    <td>\( \delta_i^\text{ru} \) </td>
    <td> Fraction of regulation up provided from time period \(i\) to \(i+1\) </td> 
    <td> % </td>
  </tr>
  <tr>
    <td>\( \delta_i^\text{rd} \) </td>
    <td> Fraction of regulation down provided from time period \(i\) to \(i+1\)</td> 
    <td> % </td>
  </tr>
  <tr>
    <td>\( R \) </td>
    <td> Discount/interest rate</td> 
    <td> % </td>
  </tr>
  <tr>
    <td>\( \gamma_i^\text{ru} \) </td>
    <td> Performance score for reg up from time period \(i\) to \(i+1\)</td>
    <td> -- </td>
  </tr>
  <tr>
    <td>\( \gamma_i^\text{rd} \) </td>
    <td> Performance score for reg down from time period \(i\) to \(i+1\)</td>
    <td> -- </td>
  </tr>
  <tr>
    <td>\( \beta_i^\text{ru} \) </td>
    <td> Mileage multiplier for reg up from time period \(i\) to \(i+1\) </td>
    <td> -- </td>
  </tr>
  <tr>
    <td>\( \beta_i^\text{rd} \) </td>
    <td> Mileage multiplier for reg down from time period \(i\) to \(i+1\) </td>
    <td> -- </td>
  </tr>
  <tr>
    <td>\( \lambda_i \) </td>
    <td> Electricity price from time period \(i\) to \(i+1\)  </td> 
    <td> $/MWh </td>
  </tr>
  <tr>
    <td>\( \lambda_i^\text{c,ru} \) </td>
    <td> Freq. regulation up price from time period \(i\) to \(i+1\) </td>
    <td> $/MWh </td>
  </tr>
  <tr>
    <td>\( \lambda_i^\text{c,rd} \) </td>
    <td> Freq. regulation down price from time period \(i\) to \(i+1\) </td>
    <td> $/MWh </td>
  </tr>
    <tr>
    <td>\( \lambda_i^\text{p,ru} \) </td>
    <td> Freq. regulation mileage (performance) up price from time period \(i\) to \(i+1\) </td>
    <td> $/MWh </td>
  </tr>
  <tr>
    <td>\( \lambda_i^\text{p,rd} \) </td>
    <td> Freq. regulation mileage (performance) down price from time period \(i\) to \(i+1\) </td>
    <td> $/MWh </td>
  </tr>
</table>
<h4>Table 2: Notation</h4>
</div> -->


This optimization is formulated in Python using <a href="http://www.pyomo.org">Pyomo</a> and solved using the numerical solver selected in QuESt Valuation. 


<h3>Assumptions</h3>
<h3>Tu please add assumptions</h3>
<!-- The following assumptions were used:
<ul>
  <li> The time periods are hourly. </li>
  <li> The discount/interest rate is fixed and equal to 0. </li>
  <li> The amount of energy provided for regulation up is equal to 25% of the quantity offered. </li>
  <li> The amount of energy provided for regulation down is equal to 25% of the quantity offered. </li>
</ul> -->


<h2>Summary of results</h2>

<!-- Figures from wizard reporting screen -->
<div align="center"> <!-- center content -->
{% for chart in charts %}
  <img src="{{ chart.path }}", class="center" width="80%">
  <h3>Fig. {{ chart.ix }}: {{ chart.caption }}</h3>  

{% endfor %}
</div>

<h2> References </h2>  

<div>
  Nguyen, T., and R. Byrne. "Maximizing the cost-savings for time-of-use and net-metering customers using behind-the-meter energy storage systems." Proceedings of the 2017 North American Power Symposium (NAPS). 2017. Available <a href="https://www.sandia.gov/ess-ssl/docs/IEEE_NAPS_17_proof.pdf">here</a>.
</div>

<h2> Acknowledgements </h2>  

{{ acknowledgement }}

<br />
<br />
<img src="{{SNL_image}}" width="40%" align="middle"> &emsp; &emsp; &emsp; &emsp; <img src="{{DOE_image}}" width="15%" align="middle">

</div>
</body>
</html>